<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF to PPTX Converter</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Lucideアイコンを使えるように展開
        const { Upload, Download, Loader2, CheckCircle2, X, Film, FileArchive, ScrollText, Settings2, Presentation, Sparkles, FileText, Zap, RefreshCw } = lucide;

        // あなたの提供したReactコードをここから下に貼り付け（一部調整済み）
        const { useState, useEffect, useRef } = React;

        const loadScript = (src) => {
          return new Promise((resolve, reject) => {
            if (document.querySelector(`script[src="${src}"]`)) {
              resolve();
              return;
            }
            const script = document.createElement('script');
            script.src = src;
            script.onload = resolve;
            script.onerror = reject;
            document.body.appendChild(script);
          });
        };

        function App() {
          // --- ここに元のコードのロジック部分を貼り付け ---
          const [isDragging, setIsDragging] = useState(false);
          const [file, setFile] = useState(null);
          const [status, setStatus] = useState('idle');
          const [progress, setProgress] = useState({ current: 0, total: 0, message: '' });
          const [generatedImages, setGeneratedImages] = useState([]);
          const [zipBlob, setZipBlob] = useState(null);
          const [errorMsg, setErrorMsg] = useState('');
          const [librariesLoaded, setLibrariesLoaded] = useState(false);
          
          const [gifStatus, setGifStatus] = useState('idle'); 
          const [longImageStatus, setLongImageStatus] = useState('idle');
          const [pptxStatus, setPptxStatus] = useState('idle');
          const [gifInterval, setGifInterval] = useState(1.0);

          const fileInputRef = useRef(null);
          const cancelProcessingRef = useRef(false);

          useEffect(() => {
            const loadLibs = async () => {
              try {
                await loadScript('https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js');
                await loadScript('https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js');
                await loadScript('https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js');
                await loadScript('https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js');
                
                if (window.pdfjsLib) {
                  window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                }
                setLibrariesLoaded(true);
              } catch (err) {
                setErrorMsg('ライブラリの読み込みに失敗しました。');
              }
            };
            loadLibs();
          }, []);

          // ... (中略: ロジック部分はあなたのコードと同じ) ...
          // スペースの関係で一部省略していますが、実際にはあなたのコードの関数をすべてここに入れます。
          const handleDragOver = (e) => { e.preventDefault(); setIsDragging(true); };
          const handleDragLeave = (e) => { e.preventDefault(); setIsDragging(false); };
          const handleDrop = (e) => {
            e.preventDefault();
            setIsDragging(false);
            if (e.dataTransfer.files && e.dataTransfer.files[0]) {
              const droppedFile = e.dataTransfer.files[0];
              droppedFile.type === 'application/pdf' ? startProcessing(droppedFile) : setErrorMsg('PDFのみ対応しています。');
            }
          };
          const handleFileSelect = (e) => {
            if (e.target.files && e.target.files[0]) startProcessing(e.target.files[0]);
          };

          const startProcessing = async (selectedFile) => {
            if (!librariesLoaded) return;
            setFile(selectedFile);
            setStatus('processing');
            setGeneratedImages([]);
            setZipBlob(null);
            setErrorMsg('');
            setProgress({ current: 0, total: 0, message: 'Analyzing...' });
            cancelProcessingRef.current = false;

            try {
              const arrayBuffer = await selectedFile.arrayBuffer();
              const pdf = await window.pdfjsLib.getDocument(arrayBuffer).promise;
              const totalPages = pdf.numPages;
              const images = [];
              const zip = new window.JSZip();
              const folder = zip.folder("images");

              for (let i = 1; i <= totalPages; i++) {
                if (cancelProcessingRef.current) break;
                const page = await pdf.getPage(i);
                const viewport = page.getViewport({ scale: 2.0 });
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                await page.render({ canvasContext: context, viewport }).promise;

                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                const dataUrl = canvas.toDataURL('image/png');
                images.push({ id: i, dataUrl, name: `slide_${i}.png`, width: viewport.width, height: viewport.height });
                folder.file(`slide_${String(i).padStart(2, '0')}.png`, blob);
                setProgress({ current: i, total: totalPages, message: `${Math.round((i/totalPages)*100)}%` });
              }
              setGeneratedImages(images);
              setStatus('zipping');
              const content = await zip.generateAsync({ type: "blob" });
              setZipBlob(content);
              setStatus('complete');
            } catch (err) { setStatus('error'); }
          };

          const downloadFile = (blob, filename) => {
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
          };

          const generatePptx = async () => {
            setPptxStatus('processing');
            const pptx = new window.PptxGenJS();
            generatedImages.forEach(img => {
